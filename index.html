<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì¤‘ì›ê³  ê³µì§€ ì•Œë¦¬ë¯¸</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body { font-family: 'Segoe UI', sans-serif; background-color: #f5f8fc; margin:0; padding:20px; color:#333; }
header { text-align:center; padding:20px 0; background-color:#1c3c78; color:white; }
.container { max-width:900px; margin:0 auto; }
h2 { border-bottom:2px solid #1c3c78; padding-bottom:5px; margin-top:40px; }
.card { background:white; padding:15px 20px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.1); margin-bottom:20px; position:relative; }
.date { font-weight:bold; color:#1c3c78; }
.title { font-size:18px; margin:5px 0; }
.description { font-size:14px; color:#555; white-space:pre-wrap; }
.edit-btn, .delete-btn { position:absolute; top:15px; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:12px; color:white; }
.edit-btn { right:70px; background-color:#1c3c78; }
.delete-btn { right:15px; background-color:#c0392b; }
.edit-btn:hover { background-color:#163063; }
.delete-btn:hover { background-color:#962d22; }
.add-btn { display:block; margin:20px auto; padding:10px 20px; background-color:#1c3c78; color:white; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
.add-btn:hover { background-color:#163063; }
.back-btn { margin:15px 0; padding:8px 16px; background-color:#888; color:white; border:none; border-radius:6px; cursor:pointer; }
.back-btn:hover { background-color:#555; }
textarea, input { width:100%; box-sizing:border-box; margin-top:4px; font-family:inherit; }
.file-preview { margin-top:10px; }
.file-preview img { max-width:200px; border-radius:6px; margin-top:5px; display:block; }
.file-link { display:inline-block; margin-top:5px; color:#1c3c78; text-decoration:underline; }
.hidden { display:none; }
</style>
</head>
<body>
<header>
<h1>ì¤‘ì›ê³  í–‰ì‚¬Â·ìˆ˜í–‰í‰ê°€ ì•Œë¦¬ë¯¸</h1>
<p>ì˜¤ëŠ˜ì˜ ê³µì§€ì‚¬í•­ì„ ë¹ ë¥´ê²Œ í™•ì¸í•˜ì„¸ìš”</p>
</header>

<!-- ë°˜ ì„ íƒ í™”ë©´ -->
<div id="class-select" class="container">
<h2>ìì‹ ì˜ ë°˜ì„ ì…ë ¥í•˜ì„¸ìš”</h2>
<p>ğŸ‘‰ ë„ì–´ì“°ê¸° ì—†ì´ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 1í•™ë…„7ë°˜)</p>
<input type="text" id="class-input" placeholder="ì˜ˆ: 1í•™ë…„7ë°˜">
<button id="class-confirm-btn">í™•ì¸</button>
</div>

<!-- ê³µì§€ í™”ë©´ -->
<div class="container hidden" id="main-container">
<button class="back-btn" id="back-btn">â† ì´ì „ìœ¼ë¡œ</button>
<button class="add-btn" id="add-general-btn">+ ê³µì§€ ì¶”ê°€í•˜ê¸°</button>
<h2>ğŸ“… ì˜¤ëŠ˜ì˜ í–‰ì‚¬</h2>
<div id="notice-list"></div>
<h2 id="class-title">ğŸ“ ìˆ˜í–‰í‰ê°€</h2>
<button class="add-btn" id="add-class-btn">+ ìˆ˜í–‰í‰ê°€ ì¶”ê°€í•˜ê¸°</button>
<div id="class-notice-list"></div>
</div>

<!-- ê³µì§€ ì¶”ê°€ í¼ -->
<div id="add-form" class="container hidden">
<h2>ğŸ“Œ ìƒˆ ê³µì§€ ì¶”ê°€</h2>
<input type="text" id="add-date" placeholder="ë‚ ì§œ (ì˜ˆ: 2025-07-25)">
<input type="text" id="add-title" placeholder="ì œëª©">
<textarea id="add-desc" placeholder="ë‚´ìš©"></textarea>
<input type="file" id="add-file" accept=".pdf,image/*">
<br><br>
<button class="add-btn" id="submit-add-btn">ë“±ë¡</button>
<button class="back-btn" id="cancel-add-btn">ì·¨ì†Œ</button>
</div>

<script>
const PASSWORD = "0922";
let currentClass = null; 
let addingType = null; 
const socket = io();

// DOM
const classInput = document.getElementById('class-input');
const noticeList = document.getElementById('notice-list');
const classNoticeList = document.getElementById('class-notice-list');

// í™”ë©´ ì „í™˜
function setClass() {
    const raw = classInput.value.trim().replace(/\s+/g,'');
    if (!/^1í•™ë…„[1-9]ë°˜$/.test(raw)) { alert("í˜•ì‹ ì˜¤ë¥˜"); return; }
    currentClass = raw;
    document.getElementById("class-select").classList.add("hidden");
    document.getElementById("main-container").classList.remove("hidden");
    document.getElementById("class-title").textContent = `ğŸ“ ${currentClass} ìˆ˜í–‰í‰ê°€`;
}
document.getElementById('class-confirm-btn').onclick = setClass;
document.getElementById('back-btn').onclick = () => { currentClass=null; document.getElementById("main-container").classList.add("hidden"); document.getElementById("class-select").classList.remove("hidden"); };

// ì¶”ê°€ í¼
function openAddForm(type) {
    const pw = prompt("ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"); if(pw!==PASSWORD){alert("í‹€ë¦¼"); return;}
    addingType = type;
    document.getElementById("main-container").classList.add("hidden");
    document.getElementById("add-form").classList.remove("hidden");
}
document.getElementById("add-general-btn").onclick = ()=>openAddForm("general");
document.getElementById("add-class-btn").onclick = ()=>openAddForm("class");
document.getElementById("cancel-add-btn").onclick = ()=>{
    addingType=null;
    document.getElementById("add-form").classList.add("hidden");
    document.getElementById("main-container").classList.remove("hidden");
};

// ê³µì§€ ë“±ë¡
document.getElementById("submit-add-btn").onclick = async ()=>{
    const date=document.getElementById("add-date").value.trim();
    const title=document.getElementById("add-title").value.trim();
    const description=document.getElementById("add-desc").value.trim();
    if(!date||!title||!description){alert("ëª¨ë‘ ì…ë ¥"); return;}

    const fileInput=document.getElementById("add-file");
    let fileData=null, fileName="", fileType="";
    if(fileInput.files.length>0){
        const file=fileInput.files[0];
        fileName=file.name; fileType=file.type;
        fileData = await new Promise(resolve=>{
            const reader
