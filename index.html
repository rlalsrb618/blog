<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì¤‘ì›ê³  ê³µì§€ ì•Œë¦¬ë¯¸ (ë‹¨ìˆœ ë¹„ë°€ë²ˆí˜¸ ë²„ì „)</title>
<style>
body{font-family:'Segoe UI',system-ui,-apple-system,Malgun Gothic,sans-serif;background:#f8f9fb;margin:0;color:#333}
header{background:#1c3c78;color:#fff;text-align:center;padding:24px 12px}
.container{max-width:980px;margin:0 auto;padding:20px}
.btn{background:#1c3c78;color:#fff;border:0;border-radius:6px;padding:8px 14px;cursor:pointer}
.btn.danger{background:#c0392b}
.btn.muted{background:#888}
select,input,textarea{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;font:inherit}
.card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);margin-bottom:12px}
</style>
</head>
<body>
<header>
  <h1>ì¤‘ì›ê³  ê³µì§€ ì•Œë¦¬ë¯¸</h1>
</header>
<section class="container">
  <div>
    <label>ë°˜ ì„ íƒ</label>
    <select id="class-select">
      <option value="" selected disabled>ë°˜ ì„ íƒ</option>
      <option>1í•™ë…„1ë°˜</option>
      <option>1í•™ë…„2ë°˜</option>
      <option>1í•™ë…„3ë°˜</option>
      <option>1í•™ë…„4ë°˜</option>
      <option>1í•™ë…„5ë°˜</option>
      <option>1í•™ë…„6ë°˜</option>
      <option>1í•™ë…„7ë°˜</option>
      <option>1í•™ë…„8ë°˜</option>
      <option>1í•™ë…„9ë°˜</option>
    </select>
  </div>
  <button id="btn-enter" class="btn">í™•ì¸</button>
</section>
<section class="container hidden" id="main">
  <div style="display:flex;gap:10px;margin-bottom:12px">
    <button id="btn-back" class="btn muted">â† ë°˜ ë‹¤ì‹œ ì„ íƒ</button>
    <button id="btn-add" class="btn">+ ê¸€ ì¶”ê°€</button>
  </div>
  <h2>ğŸ“… í–‰ì‚¬ (ê³µí†µ)</h2>
  <div id="events"></div>
  <h2>ğŸ“ ìˆ˜í–‰í‰ê°€</h2>
  <div id="assessments"></div>
  <h2 id="class-title">ğŸ“£ ë°˜ë³„ ê³µì§€</h2>
  <div id="classNotices"></div>
</section>
<section class="container hidden" id="editor">
  <h2 id="editor-title">ê¸€ ì‘ì„±</h2>
  <label>ì¹´í…Œê³ ë¦¬</label>
  <select id="category">
    <option value="event">í–‰ì‚¬</option>
    <option value="assessment">ìˆ˜í–‰í‰ê°€</option>
    <option value="class">ë°˜ë³„ ê³µì§€</option>
  </select>
  <label>ì œëª©</label><input id="title" type="text">
  <label>ë‚ ì§œ</label><input id="date" type="date">
  <label>ë‚´ìš©</label><textarea id="desc"></textarea>
  <label>ì´ë¯¸ì§€</label><input id="file" type="file" accept="image/*">
  <div style="margin-top:10px">
    <button id="btn-save" class="btn">ì €ì¥</button>
    <button id="btn-cancel" class="btn muted">ì·¨ì†Œ</button>
  </div>
</section>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
const firebaseConfig = {
  apiKey: "AIzaSyAxyzwEpyLDxBjS9Wn2wjgzrphx4surn5g",
  authDomain: "jungwonjd2.firebaseapp.com",
  projectId: "jungwonjd2",
  storageBucket: "jungwonjd2.firebasestorage.app",
  messagingSenderId: "197915083889",
  appId: "1:197915083889:web:5c85a163afcf7311eb07d0"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentClass=null;
let masterPassword="0922";
let classPasswords={"1í•™ë…„1ë°˜":"1111","1í•™ë…„2ë°˜":"2222"}; // ì˜ˆì‹œ
const $=s=>document.querySelector(s);

$('#btn-enter').onclick=()=>{
  const v=$('#class-select').value;
  if(!v) return alert('ë°˜ì„ ì„ íƒí•˜ì„¸ìš”');
  currentClass=v;
  $('#main').classList.remove('hidden');
  $('#class-title').textContent=`ğŸ“£ ${v} ë°˜ë³„ ê³µì§€`;
  loadAll();
  document.querySelector('section.container').classList.add('hidden');
};
$('#btn-back').onclick=()=>location.reload();
$('#btn-add').onclick=()=>{
  $('#editor').classList.remove('hidden');
  $('#main').classList.add('hidden');
};
$('#btn-cancel').onclick=()=>{
  $('#editor').classList.add('hidden');
  $('#main').classList.remove('hidden');
};

async function loadAll(){
  const ev=await getDocs(collection(db,'events'));
  const evBox=$('#events');evBox.innerHTML='';
  ev.forEach(d=>evBox.innerHTML+=cardHTML(d.data(),'event'));
  const as=await getDocs(collection(db,'assessments'));
  const asBox=$('#assessments');asBox.innerHTML='';
  as.forEach(d=>asBox.innerHTML+=cardHTML(d.data(),'assessment'));
  const cl=await getDocs(collection(db,'classNotices'));
  const clBox=$('#classNotices');clBox.innerHTML='';
  cl.forEach(d=>{if(d.data().className===currentClass)clBox.innerHTML+=cardHTML(d.data(),'class')});
}
function cardHTML(n,type){
  return `<div class='card'><b>${n.title||'(ì œëª©ì—†ìŒ)'}</b><br>${n.date||''}<p>${n.description||''}</p>${n.image?`<img src='${n.image}' style='max-width:200px'>`:''}</div>`;
}

$('#btn-save').onclick=async()=>{
  const category=$('#category').value;
  const title=$('#title').value.trim();
  const desc=$('#desc').value.trim();
  const date=$('#date').value;
  const file=$('#file').files[0];
  if(!title||!desc||!date) return alert('ë¹ˆì¹¸ì„ ì±„ìš°ì„¸ìš”');
  let pass=prompt('ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ (ë§ˆìŠ¤í„° ë˜ëŠ” ë°˜ ë¹„ë²ˆ)');
  if(!pass) return;
  if(category==='event'||category==='assessment'){
    if(pass!==masterPassword) return alert('ë§ˆìŠ¤í„° ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦¼');
  }
  if(category==='class'){
    const clsOk=classPasswords[currentClass]===pass||pass===masterPassword;
    if(!clsOk) return alert('ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼');
  }
  let imageData='';
  if(file){
    const r=new FileReader();
    imageData=await new Promise(res=>{r.onload=e=>res(e.target.result);r.readAsDataURL(file);});
  }
  const base={title,description:desc,date,image:imageData,className:currentClass,createdAt:serverTimestamp()};
  if(category==='event') await addDoc(collection(db,'events'),base);
  if(category==='assessment') await addDoc(collection(db,'assessments'),base);
  if(category==='class') await addDoc(collection(db,'classNotices'),base);
  alert('ì €ì¥ë¨');
  location.reload();
};
</script>
</body>
</html>
